<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Maturação - Tempo Real</title>
<style>
    body { font-family: Arial, sans-serif; background-color: #f5f5f5; margin:0; padding:20px; }
    h1 { color: #ff69b4; text-align:center; }
    .container { max-width: 1200px; margin:0 auto; }
    .agentes { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
    .agente { flex:1 1 150px; background-color:#fff; border-radius:10px; padding:10px;
              box-shadow:0px 2px 5px rgba(0,0,0,0.2); text-align:center; font-size:14px; }
    .conectado { color:green; font-weight:bold; }
    .desconectado { color:red; font-weight:bold; }
    button { background-color:#ffa500; color:white; border:none; padding:10px 20px;
             font-size:16px; cursor:pointer; border-radius:8px; margin:5px; transition:0.3s; }
    button:hover { background-color:#ffcc00; }
    #logs { background-color:#fff; border-radius:10px; padding:10px; height:300px;
            overflow-y:scroll; box-shadow:0px 2px 5px rgba(0,0,0,0.2); font-family:monospace; margin-top:20px; }
</style>
</head>
<body>
<h1>Painel de Maturação - Tempo Real</h1>
<div class="container">
    <div>
        <button onclick="iniciarMaturacao()">Iniciar Maturação</button>
        <button onclick="pararMaturacao()">Parar Maturação</button>
    </div>

    <h2>Agentes Conectados</h2>
    <div class="agentes" id="agentes-lista"></div>

    <h2>Logs</h2>
    <div id="logs"></div>
</div>

<script>
const agentesLista = document.getElementById('agentes-lista');
const logs = document.getElementById('logs');

// Função para atualizar a lista de agentes
function atualizarAgentes() {
    fetch('/teste')  // Rota Flask que retorna JSON de agentes: [{nome, conectado}, ...]
    .then(res => res.json())
    .then(data => {
        agentesLista.innerHTML = '';
        data.forEach(ag => {
            const div = document.createElement('div');
            div.classList.add('agente');
            div.innerHTML = `<p>${ag.nome}</p><p class="${ag.conectado ? 'conectado' : 'desconectado'}">
                             ${ag.conectado ? 'Conectado' : 'Desconectado'}</p>`;
            agentesLista.appendChild(div);
        });
    })
    .catch(err => console.error("Erro ao atualizar agentes:", err));
}

// Função para adicionar logs
function log(mensagem) {
    const p = document.createElement('p');
    p.textContent = `[${new Date().toLocaleTimeString()}] ${mensagem}`;
    logs.appendChild(p);
    logs.scrollTop = logs.scrollHeight;
}

// Funções para iniciar/parar maturação
function iniciarMaturacao() {
    fetch('/iniciar', { method:'POST' })
    .then(() => log("Maturação iniciada"))
    .catch(() => log("Erro ao iniciar maturação"));
}

function pararMaturacao() {
    fetch('/parar', { method:'POST' })
    .then(() => log("Maturação parada"))
    .catch(() => log("Erro ao parar maturação"));
}

// Atualiza agentes a cada 5 segundos
setInterval(atualizarAgentes, 5000);

// Atualiza agentes imediatamente ao carregar
atualizarAgentes();

// Exemplo: atualizar logs via polling (opcional)
setInterval(() => {
    fetch('/logs')  // rota Flask que retorna os logs recentes
    .then(res => res.json())
    .then(data => {
        data.forEach(m => log(m));
    });
}, 3000);
</script>
</body>
</html>
